import { Injectable, OnModuleInit } from '@nestjs/common';
import * as TelegramBot from 'node-telegram-bot-api';

@Injectable()
export class TelegramService implements OnModuleInit {
  private bot: TelegramBot;

  constructor() {
    const token = process.env.TELEGRAM_BOT_TOKEN;
    if (!token) {
      throw new Error(
        'TELEGRAM_BOT_TOKEN is not defined in environment variables',
      );
    }
    this.bot = new TelegramBot(token, { polling: true });
  }

  onModuleInit() {
    this.bot.onText(/\/start/, (msg) => {
      this.sendWelcomeMessage(msg.chat.id);
    });

    this.bot.on('message', (msg) => {
      const chatId = msg.chat.id;
      const text = msg.text;

      switch (text) {
        case 'üöò –î–∂–∏–ø-—Ç—É—Ä—ã':
          this.sendMessageWithBackOption(
            chatId,
            'üöô –ü–æ–¥–±–µ—Ä—ë–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –ø–æ –≥–æ—Ä–∞–º. –í –Ω–∞—à–µ–º –∞–≤—Ç–æ–ø–∞—Ä–∫–µ –Ω–æ–≤—ã–µ –¥–∂–∏–ø—ã tank 300 2024 –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞.',
          );
          break;
        case 'üèçÔ∏è –ú–æ—Ç–æ-—Ç—É—Ä—ã':
          this.sendMessageWithBackOption(
            chatId,
            'üèçÔ∏è –ü–æ–¥–±–µ—Ä—ë–º –º–æ—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞. –í –Ω–∞—à–µ–º –º–æ—Ç–æ–ø–∞—Ä–∫–µ: –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª—ã, –±–∞–≥–≥–∏ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ã —ç–Ω–¥—É—Ä–æ (–∫—Ä–æ—Å—Å–æ–≤—ã–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã).',
          );
          break;
        case 'üèòÔ∏è –†–∞–∑–º–µ—â–µ–Ω–∏–µ':
          this.sendMessageWithBackOption(
            chatId,
            'üè° –ü–æ–¥–±–µ—Ä—ë–º –ª—é–±–æ–π –≤–∏–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –°–µ–≤–µ—Ä–Ω–æ–π –û—Å–µ—Ç–∏–∏ –≤ –≥–æ—Ä–æ–¥–µ –∏–ª–∏ –≤ –≥–æ—Ä–∞—Ö: –æ—Ç–µ–ª—å/–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞, –∫–æ—Ç—Ç–µ–¥–∂, –≥–ª–µ–º–ø–∏–Ω–≥ ‚Ä¶',
          );
          break;
        case '‚õ∫Ô∏è –ö–µ–º–ø–∏–Ω–≥':
          this.sendMessageWithBackOption(
            chatId,
            'üèïÔ∏è –û—Ä–≥–∞–Ω–∏–∑—É–µ–º –ø–∞–ª–∞—Ç–æ—á–Ω—ã–π –≥–æ—Ä–æ–¥–æ–∫ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –∏ –Ω–æ—á—ë–≤–∫–∏ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ.',
          );
          break;
        case 'üßóüèª –ü–µ—à–∏–µ —Ç—É—Ä—ã':
          this.sendMessageWithBackOption(
            chatId,
            'ü•æ –ü–æ—Ö–æ–¥—ã –≤ –≥–æ—Ä—ã —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏ –∂–∏–≤–æ–ø–∏—Å–Ω—ã—Ö –º–µ—Å—Ç.',
          );
          break;
        case 'üî• –î–æ–ø. —É—Å–ª—É–≥–∏':
          this.sendMessageWithBackOption(
            chatId,
            'üõ¨ –¢—Ä–∞–Ω—Å—Ñ–µ—Ä –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞, –±–∞–Ω—è, —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Å—ä—ë–º–∫–∞, –ø–æ–ª–µ–≤–∞—è –∫—É—Ö–Ω—è, –∫–∞—Ç–∞–Ω–∏–µ –Ω–∞ –ª–æ—à–∞–¥—è—Ö.',
          );
          break;
        case '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è':
          this.sendMessageWithBackOption(
            chatId,
            '‚ÑπÔ∏è –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö.',
          );
          break;
        case '–û –Ω–∞—Å':
          this.sendMessageWithBackOption(
            chatId,
            'üë• –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—Å.',
          );
          break;
        case '–ù–∞–∑–∞–¥':
          this.sendWelcomeMessage(chatId);
          break;
        default:
          this.bot.sendMessage(chatId, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫.');
      }
    });
  }

  private sendWelcomeMessage(chatId: number) {
    const welcomeMessage =
      `üëã –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º! –≠—Ç–æ –•–æ—Ö–∞–≥ —Ç—É—Ä—Å\n\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ –Ω–∏–∂–µ:\n\n` +
      `üöò –î–∂–∏–ø-—Ç—É—Ä—ã ‚Äî –ø–æ–¥–±–µ—Ä—ë–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π –ø–æ –≥–æ—Ä–∞–º. –í –Ω–∞—à–µ–º –∞–≤—Ç–æ–ø–∞—Ä–∫–µ –Ω–æ–≤—ã–µ –¥–∂–∏–ø—ã tank 300 2024 –≥–æ–¥–∞ –≤—ã–ø—É—Å–∫–∞.\n\n` +
      `üèçÔ∏è –ú–æ—Ç–æ-—Ç—É—Ä—ã ‚Äî –ø–æ–¥–±–µ—Ä—ë–º –º–æ—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞. –í –Ω–∞—à–µ–º –º–æ—Ç–æ–ø–∞—Ä–∫–µ: –∫–≤–∞–¥—Ä–æ—Ü–∏–∫–ª—ã, –±–∞–≥–≥–∏ –∏ –º–æ—Ç–æ—Ü–∏–∫–ª—ã —ç–Ω–¥—É—Ä–æ (–∫—Ä–æ—Å—Å–æ–≤—ã–µ –º–æ—Ç–æ—Ü–∏–∫–ª—ã).\n\n` +
      `üèòÔ∏è –†–∞–∑–º–µ—â–µ–Ω–∏–µ ‚Äî –ø–æ–¥–±–µ—Ä—ë–º –ª—é–±–æ–π –≤–∏–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –°–µ–≤–µ—Ä–Ω–æ–π –û—Å–µ—Ç–∏–∏ –≤ –≥–æ—Ä–æ–¥–µ –∏–ª–∏ –≤ –≥–æ—Ä–∞—Ö: –æ—Ç–µ–ª—å/–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞, –∫–æ—Ç—Ç–µ–¥–∂, –≥–ª–µ–º–ø–∏–Ω–≥ ‚Ä¶\n\n` +
      `‚õ∫Ô∏è –ö–µ–º–ø–∏–Ω–≥ ‚Äî –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –ø–∞–ª–∞—Ç–æ—á–Ω—ã–π –≥–æ—Ä–æ–¥–æ–∫ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –∏ –Ω–æ—á—ë–≤–∫–∏ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ.\n\n` +
      `üßóüèª –ü–µ—à–∏–µ —Ç—É—Ä—ã ‚Äî –ø–æ—Ö–æ–¥—ã –≤ –≥–æ—Ä—ã —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏ –∂–∏–≤–æ–ø–∏—Å–Ω—ã—Ö –º–µ—Å—Ç.\n\n` +
      `üî• –î–æ–ø. —É—Å–ª—É–≥–∏ ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä –∏–∑ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞, –±–∞–Ω—è, —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Å—ä—ë–º–∫–∞, –ø–æ–ª–µ–≤–∞—è –∫—É—Ö–Ω—è, –∫–∞—Ç–∞–Ω–∏–µ –Ω–∞ –ª–æ—à–∞–¥—è—Ö.`;

    const options = this.getMainKeyboardOptions();

    this.bot.sendMessage(chatId, welcomeMessage, options);
  }

  private getMainKeyboardOptions() {
    return {
      reply_markup: {
        keyboard: [
          [{ text: 'üöò –î–∂–∏–ø-—Ç—É—Ä—ã' }, { text: 'üèçÔ∏è –ú–æ—Ç–æ-—Ç—É—Ä—ã' }],
          [{ text: 'üèòÔ∏è –†–∞–∑–º–µ—â–µ–Ω–∏–µ' }, { text: '‚õ∫Ô∏è –ö–µ–º–ø–∏–Ω–≥' }],
          [{ text: 'üßóüèª –ü–µ—à–∏–µ —Ç—É—Ä—ã' }, { text: 'üî• –î–æ–ø. —É—Å–ª—É–≥–∏' }],
          [{ text: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' }, { text: '–û –Ω–∞—Å' }],
        ],
        resize_keyboard: true,
        one_time_keyboard: true,
      },
    };
  }

  private sendMessageWithBackOption(chatId: number, message: string) {
    const options = {
      reply_markup: {
        keyboard: [[{ text: '–ù–∞–∑–∞–¥' }]],
        resize_keyboard: true,
        one_time_keyboard: true,
      },
    };

    this.bot.sendMessage(chatId, message, options);
  }
}
